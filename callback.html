<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>untitled</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Ben Lamb">
	<!-- Date: 2012-10-18 -->
	<link rel="stylesheet" href="style.css" type="text/css" media="screen" />
	
	
</head>
<body onload="document.getElementById('copybox').focus()">
	<img src="prairiebox.png">
    <h1>Prairie Box</h1>
	Foursquare for GPS-enabled JavaME phones
	<br>
	<br>
	<p class="success">
		Your foursquare authorization token is:
		<br>
		<input type="text" id="copybox" value="ERROR. NO JAVASCRIPT." onselect="select_text();" onkeyup="select_text();" onclick="select_text();"> 
		<br>
		ready to be copied to your clipboard
	</p>
	<script language="JavaScript" type="text/javascript"> 
	<!-- 
		//Highlight copybox
		function select_text() { 
			el = document.getElementById('copybox'); 
			if (el.createTextRange) { 
				var oRange = el.createTextRange(); 
				oRange.moveStart("character", 0); 
				oRange.moveEnd("character", el.value.length); 
				oRange.select(); 
			} 
			else if (el.setSelectionRange) { 
				el.setSelectionRange(0, el.value.length); 
			} 
			el.focus(); 
		} 
		
		//parse URL GET http://papermashup.com/read-url-get-variables-withjavascript/
		function getUrlVars() {
		    var vars = {};
		    var parts = window.location.href.replace(/[#&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
		        vars[key] = value;
		    });
		    return vars;
		}
		
		//token from URL GET
		function token_get() {
			textbox = document.getElementById('copybox');
			token = getUrlVars()["access_token"];
			if(null== token)
			{
				token = "ERROR. DID NOT GET TOKEN.";
			}			
			textbox.value = token;
		}
		
		//init this ish
		function PageInit() {
			token_get(); 
			select_text(); 
		} 
		window.onload = PageInit; 
		
		var req = new XMLHttpRequest();
		req.open('GET', document.location, false);
		req.send(null);
		var headers = req.getAllResponseHeaders().toLowerCase();
		alert(window.location.hash(1));
	
	//--> 
	</script>
	
</body>
</html>
